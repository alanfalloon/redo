# -*- mode: shell-script -*-
dirmsg() {
    echo "$1" directory "\`$2'" >&2
}
dirmsg Entering "$2"
trap "dirmsg Leaving $2" EXIT

(
    OUT="$PWD"/"$3" &&
    cd ../"$2" &&
    go build -o "$OUT"
)

# Automatic dependancy generation by slurping the file-names out of
# the debug symbols of the resulting binaries.
strings "$3" |
sed -n -e "s#^$REDO_STARTDIR/##p" |
sort -u |
(
    cd "$REDO_STARTDIR" &&
    xargs redo-ifchange bin/_gobuild
)
